<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NeonDAW</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="app" class="glass-panel">

    <!-- Top Navigation / Transport Bar -->
    <header class="top-bar glass">
      <h1 class="logo">🎶 NeonDAW</h1>
      <div class="transport-controls">
        <button id="play-btn">▶️</button>
        <button id="stop-btn">⏹</button>
        <button id="record-btn">🔴</button>
      </div>
    </header>

    <!-- Main UI Grid: Mixer (Left) + Timeline (Right) -->
    <main id="main-ui" class="main-editor">

      <!-- Mixer Panel -->
      <section id="mixer-panel" class="glass">
        <h2>Mixer</h2>
        <div id="track-list">
          <!-- Track strips dynamically added here -->
        </div>
        <button id="add-track-btn" class="glow-btn">➕ Add Track</button>
      </section>

      <!-- Timeline Panel -->
      <section id="timeline-panel" class="glass">
        <h2>Timeline</h2>
        <div id="timeline-dropzone">
          <p>🗂️ Drag & Drop Audio Files Here</p>
        </div>
        <input type="range" id="zoom-slider" min="1" max="4" value="1" step="0.25" />
        <div id="timeline-tracks">
          <!-- Timeline rows will be added here -->
        </div>
      </section>

    </main>
  </div>

  <div class="footer-controls">
    <button id="save-project">💾 Save Project</button>
    <button id="load-project">📂 Load Project</button>
  </div>

  <!-- FX Panel (Optional hidden section) -->
  <div id="fx-panel" class="glass hidden">
    <button id="close-fx-btn">Close FX</button>
    <!-- FX controls can be added here -->
  </div>

  <!-- Inline Script -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const addTrackBtn = document.getElementById('add-track-btn');
      const trackList = document.getElementById('track-list');
      const timelineTracks = document.getElementById('timeline-tracks');
      const dropzone = document.getElementById('timeline-dropzone');

      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      let tracks = [];

      addTrackBtn.addEventListener('click', () => {
        const track = createTrack(tracks.length);
        tracks.push(track);
        updateUI();
      });

      dropzone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropzone.style.borderColor = '#0ff';
      });

      dropzone.addEventListener('dragleave', () => {
        dropzone.style.borderColor = '#00f0ff';
      });

      dropzone.addEventListener('drop', (e) => {
        e.preventDefault();
        const file = e.dataTransfer.files[0];
        alert(`🎵 Imported file: ${file.name}`);
        dropzone.style.borderColor = '#00f0ff';
        // Handle drop import logic here later
      });

      function createTrack(index) {
        const track = {
          index,
          audioElement: new Audio(),
          gainNode: audioContext.createGain(),
          panNode: audioContext.createStereoPanner(),
          reverbNode: audioContext.createConvolver(),
          delayNode: audioContext.createDelay(),
          eqNode: audioContext.createBiquadFilter(),
          muted: false,
          soloed: false,
          sourceNode: null
        };

        track.audioElement.crossOrigin = "anonymous";
        track.sourceNode = audioContext.createMediaElementSource(track.audioElement);
        track.sourceNode.connect(track.gainNode);
        track.gainNode.connect(track.panNode);
        track.panNode.connect(track.reverbNode);
        track.reverbNode.connect(track.delayNode);
        track.delayNode.connect(track.eqNode);
        track.eqNode.connect(audioContext.destination);

        // Defaults
        track.gainNode.gain.value = 1;
        track.delayNode.delayTime.value = 0.3;
        track.eqNode.type = 'lowshelf';
        track.eqNode.frequency.value = 1000;

        return track;
      }

      function updateUI() {
        trackList.innerHTML = '';
        timelineTracks.innerHTML = '';

        tracks.forEach((track, i) => {
          // === Mixer Strip ===
          const trackStrip = document.createElement('div');
          trackStrip.className = 'track-strip';
          trackStrip.innerHTML = `
            <h4>Track ${i + 1}</h4>
            <button class="mute-btn" data-index="${i}">Mute</button>
            <button class="solo-btn" data-index="${i}">Solo</button>
            <label>Vol</label><input type="range" class="volume" min="0" max="1" step="0.01" value="1" data-index="${i}">
            <label>Pan</label><input type="range" class="pan" min="-1" max="1" step="0.1" value="0" data-index="${i}">
            <button class="fx-btn" data-index="${i}">🎛 FX</button>
          `;
          trackList.appendChild(trackStrip);

          // === Timeline Track ===
          const timelineRow = document.createElement('div');
          timelineRow.className = 'timeline-row';
          timelineRow.innerHTML = `
            <p>Track ${i + 1}</p>
            <input type="file" accept="audio/*" class="file-input" data-index="${i}">
            <canvas width="240" height="60" class="waveform"></canvas>
            <button class="play-btn" data-index="${i}">▶</button>
            <button class="stop-btn" data-index="${i}">■</button>
          `;
          timelineTracks.appendChild(timelineRow);
        });

        document.querySelectorAll('.volume').forEach(slider => {
          slider.addEventListener('input', (e) => {
            const idx = e.target.dataset.index;
            tracks[idx].gainNode.gain.value = e.target.value;
          });
        });

        document.querySelectorAll('.pan').forEach(slider => {
          slider.addEventListener('input', (e) => {
            const idx = e.target.dataset.index;
            tracks[idx].panNode.pan.value = e.target.value;
          });
        });

        document.querySelectorAll('.mute-btn').forEach(btn => {
          btn.addEventListener('click', (e) => toggleMute(e.target.dataset.index));
        });

        document.querySelectorAll('.solo-btn').forEach(btn => {
          btn.addEventListener('click', (e) => toggleSolo(e.target.dataset.index));
        });

        document.querySelectorAll('.fx-btn').forEach(btn => {
          btn.addEventListener('click', (e) => showFXPanel(e.target.dataset.index));
        });

        document.querySelectorAll('.play-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const idx = e.target.dataset.index;
            tracks[idx].audioElement.play();
          });
        });

        document.querySelectorAll('.stop-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const idx = e.target.dataset.index;
            tracks[idx].audioElement.pause();
            tracks[idx].audioElement.currentTime = 0;
          });
        });

        document.querySelectorAll('.file-input').forEach(input => {
          input.addEventListener('change', (e) => {
            const idx = e.target.dataset.index;
            const file = e.target.files[0];
            if (file) {
              const url = URL.createObjectURL(file);
              tracks[idx].audioElement.src = url;
              console.log(`Loaded file for track ${idx}: ${file.name}`);
            }
          });
        });
      }

      function toggleMute(index) {
        const track = tracks[index];
        track.muted = !track.muted;
        track.gainNode.gain.value = track.muted ? 0 : 1;
        document.querySelector(`.mute-btn[data-index="${index}"]`).classList.toggle('active', track.muted);
      }

      function toggleSolo(index) {
        const soloTrack = tracks[index];
        soloTrack.soloed = !soloTrack.soloed;
        tracks.forEach((track, i) => {
          track.gainNode.gain.value = (i === parseInt(index) || !soloTrack.soloed) ? 1 : 0;
        });
        document.querySelector(`.solo-btn[data-index="${index}"]`).classList.toggle('active', soloTrack.soloed);
      }

      function showFXPanel(index) {
        const fxPanel = document.getElementById('fx-panel');
        fxPanel.classList.remove('hidden');
        document.getElementById('close-fx-btn').onclick = () => fxPanel.classList.add('hidden');
        // Add FX UI logic here
      }
    });
  </script>
</body>
</html>
